<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Belajar Seru SD</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="brand">
  <div class="logo" style="font-size:2.4rem;letter-spacing:2px;display:flex;align-items:center;justify-content:center;">BS</div>
      <div>
        <div style="font-weight:700">Belajar Seru SD</div>
      </div>
    </div>
    <nav>
      <a href="#materi">Materi</a>
      <a href="#latihan" id="latihanMenu">Latihan</a>
      <a href="#kuis">Kuis</a>
    </nav>
  </header>

    <main id="content">
      <section id="home">
        <h2>Selamat Datang</h2>
        <p>Website ini dibuat untuk membantu anak SD belajar dengan cara yang menyenangkan. Yuk mulai belajar!</p>
      </section>

  <section id="materiIntro" class="hidden">
        <h2>Materi Belajar</h2>
        <ul>
          <li>Matematika: Penjumlahan & Pengurangan</li>
          <li>IPA: Hewan dan Tumbuhan</li>
          <li>Bahasa Indonesia: Membaca & Menulis</li>
        </ul>
      </section>

      
    </main>

    <section class="lessons" id="materi">
      <div>
        <h2>Materi & Modul</h2>
        <div class="lesson-list">
          <div class="lesson-item card" style="cursor:pointer;transition:.2s" data-subject="math">
            <div class="subject math" style="font-size:2rem;display:flex;align-items:center;justify-content:center;">M</div>
            <div>
              <strong>Matematika: Penjumlahan</strong>
              <div class="small">Konsep dasar, soal latihan, dan permainan pecahan.</div>
              <div style="margin-top:8px">
                <button class="mutebtn open-materi" data-subject="math">Buka Materi</button>
                <a href="https://www.google.com/search?q=materi+matematika+sd" target="_blank" style="margin-left:8px;color:#2196f3;text-decoration:underline;font-size:0.95em">Cari di Google</a>
              </div>
            </div>
          </div>
          <div class="lesson-item card" style="cursor:pointer;transition:.2s" data-subject="indo">
            <div class="subject indo" style="font-size:2rem;display:flex;align-items:center;justify-content:center;">B</div>
            <div>
              <strong>Bahasa Indonesia: Membaca</strong>
              <div class="small">Latihan membaca, kosa kata, dan latihan memahami teks.</div>
              <div style="margin-top:8px">
                <button class="mutebtn open-materi" data-subject="indo">Buka Materi</button>
                <a href="https://www.google.com/search?q=materi+bahasa+indonesia+sd" target="_blank" style="margin-left:8px;color:#2196f3;text-decoration:underline;font-size:0.95em">Cari di Google</a>
              </div>
            </div>
          </div>
          <div class="lesson-item card" style="cursor:pointer;transition:.2s" data-subject="sci">
            <div class="subject sci" style="font-size:2rem;display:flex;align-items:center;justify-content:center;">I</div>
            <div>
              <strong>IPA: Makhluk Hidup</strong>
              <div class="small">Pengertian, contoh, dan eksperimen sederhana di rumah.</div>
              <div style="margin-top:8px">
                <button class="mutebtn open-materi" data-subject="sci">Buka Materi</button>
                <a href="https://www.google.com/search?q=materi+ipa+sd" target="_blank" style="margin-left:8px;color:#2196f3;text-decoration:underline;font-size:0.95em">Cari di Google</a>
              </div>
            </div>
          </div>
        </div>
        <!-- Student download card (siswa) -->
        <div class="card" id="siswaWorksheet" style="display:none; padding:20px; max-width:720px; margin-left:auto; margin-right:auto; margin-top:12px;">
          <h3 style="margin-top:0;">Unduh Lembar Kerja (Siswa)</h3>
          <div style="display:flex;gap:12px">
            <div style="flex:1">
              <label class="small">Materi</label>
              <select id="siswaSubject" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e2e8f0">
                <option value="math">Matematika</option>
                <option value="indo">Bahasa Indonesia</option>
                <option value="sci">IPA</option>
                <option value="all">Semua Mapel</option>
              </select>
            </div>
            <div style="width:180px">
              <label class="small">Tipe</label>
              <select id="siswaType" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e2e8f0">
                <option value="penjumlahan">Penjumlahan</option>
                <option value="pengurangan">Pengurangan</option>
                <option value="bacaan">Pemahaman Bacaan</option>
                <option value="kata">Kata & Sinonim</option>
                <option value="ipa">Makhluk Hidup</option>
              </select>
            </div>
          </div>
          <div style="margin-top:12px">
            <button id="downloadWorksheetSiswa" class="mutebtn">Unduh Lembar Kerja</button>
          </div>
          <div id="worksheetContent" style="margin-top:10px;color:#333"></div>
        </div>
        <div id="lessonContent" style="margin-top:12px"></div>
        <div id="materiPage" style="display:none;margin-top:24px">
          <div class="card" id="materiDetail"></div>
          <form id="uploadForm" style="margin-top:18px">
            <label for="modulFile" class="small">Unggah Materi Anda (PDF/TXT):</label>
            <input type="file" id="modulFile" accept=".pdf,.txt">
            <button type="submit" class="mutebtn" style="margin-left:8px">Unggah</button>
            <div id="uploadStatus" class="small" style="margin-top:8px"></div>
            <div id="uploadedFiles" style="margin-top:10px"></div>
          </form>
        </div>
      </div>


    </section>

  <!-- Halaman Latihan: daftar lembar latihan dan unggah (hanya guru) -->
  <section id="latihanPage" style="margin-top:22px">
        <h2>Latihan & Lembar Kerja</h2>
        <div class="card" style="padding:12px; margin-bottom:12px">
          <div id="latihanControls">
            <div id="latihanList">
              <h3>Daftar Lembar Latihan</h3>
              <div id="latihanItems">Memuat daftar lembar latihan...</div>
            </div>
          </div>
        </div>

        <div class="card" id="latihanUploadCard" style="display:none; padding:20px; max-width:720px; margin-left:auto; margin-right:auto;">
          <div class="latihan-upload">
            <h3 style="margin-top:0;margin-bottom:12px">Unggah / Simpan Lembar Kerja (Guru)</h3>
            <div class="upload-row">
              <div class="upload-col">
                <label for="uploadSubject" class="small">Materi:</label>
                <select id="uploadSubject">
                  <option value="math">Matematika</option>
                  <option value="indo">Bahasa Indonesia</option>
                  <option value="sci">IPA</option>
                  <option value="all">Semua Mapel</option>
                </select>
              </div>
              <div class="upload-col">
                <label for="uploadType" class="small">Tipe:</label>
                <select id="uploadType">
                  <option value="penjumlahan">Penjumlahan</option>
                  <option value="pengurangan">Pengurangan</option>
                  <option value="bacaan">Pemahaman Bacaan</option>
                  <option value="kata">Kata & Sinonim</option>
                  <option value="ipa">Makhluk Hidup</option>
                </select>
              </div>
            </div>
            <div style="margin-top:12px;margin-bottom:14px">
              <label for="uploadFileInput" class="small">Unggah Lembar Kerja (PDF / TXT)</label>
              <div class="file-wrap">
                <input type="file" id="uploadFileInput" accept=".txt,.pdf">
              </div>
            </div>
            <div>
              <button id="uploadSaveBtn" class="btn-green-big">Simpan Lembar Kerja ke Cloud</button>
            </div>
          </div>
        </div>
      </section>


    <section id="kuis" style="margin-top:22px">
      <h2>Kuis Interaktif</h2>
      <div class="card" style="padding:18px">
        <div style="margin-bottom:12px">
          <label for="quickQuizType2" class="small">Pilih Materi:</label>
          <select id="quickQuizType2" style="margin-left:8px">
            <option value="math">Matematika</option>
            <option value="indo">Bahasa Indonesia</option>
            <option value="sci">IPA</option>
            <option value="all">Semua Mapel</option>
          </select>
          <button id="startQuiz2" style="margin-left:12px">Mulai Kuis</button>
          <button id="quizDebugBtn" style="margin-left:8px;background:#eee;border:1px solid #ccc;padding:6px;border-radius:6px;font-size:0.85em">Debug</button>
          <span id="quizStatus" style="margin-left:12px;font-size:0.95em;color:#333"></span>
        </div>
        <div id="quizBox2"></div>
      </div>
    </section>

    <footer>
      <p>© 2025 Belajar Seru SD — Dibuat untuk bahan pembelajaran siswa SD.</p>
    </footer>
  </main>

  

  <!-- Firebase App (core) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <!-- Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <!-- Auth (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    // Inline initialization so firebase.initializeApp runs before any following scripts
    (function(){
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyAG_HCNddKDQRGNLS785cicKMtdgQELSk0",
          authDomain: "pembelajaransd-4a215.firebaseapp.com",
          databaseURL: "https://pembelajaransd-4a215-default-rtdb.firebaseio.com",
          projectId: "pembelajaransd-4a215",
          storageBucket: "pembelajaransd-4a215.appspot.com",
          messagingSenderId: "807174313732",
          appId: "1:807174313732:web:c6f9dc5012a162d8b8e251",
          measurementId: "G-MEMD519RTV"
        };
        firebase.initializeApp(firebaseConfig);
  window.db = firebase.firestore();
  console.log('[firebase-init] Firebase terinisialisasi');

        // Now load the main app script which may use window.db
        const s = document.createElement('script');
        s.src = 'script.js';
        s.defer = true;
  s.onload = () => console.log('[app] script.js berhasil dimuat');
  s.onerror = (e) => console.error('[app] gagal memuat script.js', e);
        document.head.appendChild(s);
      } catch (err) {
        console.error('[firebase-init] gagal inisialisasi Firebase', err);
      }
    })();
  </script>
  <!-- Auth Modal -->
  <div id="authModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:18px;border-radius:12px;max-width:420px;margin:auto;box-shadow:0 8px 32px rgba(0,0,0,0.2)">
      <h3 style="margin-top:0;color:#2196f3">Login / Register</h3>
      <p style="color:#666;margin-top:4px">Pilih peran Anda (Guru atau Siswa). Guru dapat mengunggah lembar latihan; siswa dapat mengunduhnya.</p>
      <form id="modalAuthForm">
        <label style="display:block;margin-top:10px">Nama Pengguna</label>
        <input id="modalUsername" type="text" style="width:100%;padding:8px;border-radius:8px;border:1px solid #ddd">
        <label style="display:block;margin-top:10px">Masuk sebagai</label>
        <select id="modalRole" style="width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;margin-top:6px">
          <option value="siswa">Siswa</option>
          <option value="guru">Guru</option>
        </select>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button type="button" id="modalSaveBtn" style="flex:1;background:#2196f3;color:#fff;border:0;padding:10px;border-radius:8px">Masuk</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    function showAuthModal(){
      try {
        var m = document.getElementById('authModal');
        if (!m) return;
        m.style.display = 'flex';
        var save = document.getElementById('modalSaveBtn');
        save.onclick = function(){
          var name = (document.getElementById('modalUsername').value || '').trim();
          var role = document.getElementById('modalRole').value || 'siswa';
          if (!name) { alert('Isi nama terlebih dahulu.'); return; }
          // Try to sign in anonymously with Firebase Auth so Firestore rules that
          // require `request.auth != null` will succeed for this client.
          try {
            if (window.firebase && firebase.auth) {
              firebase.auth().signInAnonymously()
                .then(function() {
                  // store lightweight local profile for UI
                  localStorage.setItem('bs_user', JSON.stringify({ name: name, username: name.toLowerCase().replace(/\s+/g,'_'), role: role }));
                  m.style.display = 'none';
                  // reload to let app update view and let other scripts observe auth state
                  window.location.reload();
                })
                .catch(function(err){
                  console.error('Anonymous sign-in failed', err);
                  // fallback: still store local profile so UI works, but Firestore reads may fail
                  localStorage.setItem('bs_user', JSON.stringify({ name: name, username: name.toLowerCase().replace(/\s+/g,'_'), role: role }));
                  m.style.display = 'none';
                  window.location.reload();
                });
            } else {
              // If firebase auth not available, just store local profile (best-effort)
              localStorage.setItem('bs_user', JSON.stringify({ name: name, username: name.toLowerCase().replace(/\s+/g,'_'), role: role }));
              m.style.display = 'none';
              window.location.reload();
            }
          } catch(e){
            console.error('auth modal sign-in error', e);
            localStorage.setItem('bs_user', JSON.stringify({ name: name, username: name.toLowerCase().replace(/\s+/g,'_'), role: role }));
            m.style.display = 'none';
            window.location.reload();
          }
        };
      } catch(e){ console.error('auth modal error', e); }
    }
  </script>
  <script>
    // After firebase init and script load, make sure latihan upload card is visible for guru
    (function(){
      try {
        var userRaw = localStorage.getItem('bs_user');
        if (!userRaw) return;
        var user = JSON.parse(userRaw);
        var uploadCard = document.getElementById('latihanUploadCard');
        if (user.role === 'guru') {
          if (uploadCard) uploadCard.style.display = 'block';
        } else {
          if (uploadCard) uploadCard.style.display = 'none';
        }
      } catch(e) { /* ignore */ }
    })();
  </script>
  <script>
    (function(){
      try {
        // Materi logic: open materi and upload
        var materiBtns = document.querySelectorAll('.open-materi');
        var materiPage = document.getElementById('materiPage');
        var materiDetail = document.getElementById('materiDetail');
        var uploadForm = document.getElementById('uploadForm');
        var uploadedFiles = document.getElementById('uploadedFiles');
        var uploadedList = [];

        materiBtns.forEach(function(btn){
          btn.onclick = function(){
            var subject = btn.getAttribute('data-subject');
            var subjectText = subject === 'math' ? 'Matematika' : subject === 'indo' ? 'Bahasa Indonesia' : 'IPA';
            let moduleLinks = '';
            if(subject === 'math') {
              moduleLinks = `
                <ul>
                  <li><a href='https://www.ruangguru.com/blog/materi-matematika-sd' target='_blank'>Materi Matematika SD - Ruangguru</a></li>
                  <li><a href='https://www.scribd.com/document/456789012/Modul-Matematika-SD-Kelas-4' target='_blank'>Modul Matematika Kelas 4 PDF (Scribd)</a></li>
                  <li><a href='https://www.slideshare.net/aguswahyudi/materi-matematika-sd-kelas-4' target='_blank'>Materi Matematika SD Kelas 4 - Slideshare</a></li>
                </ul>
              `;
            } else if(subject === 'indo') {
              moduleLinks = `
                <ul>
                  <li><a href='https://www.ruangguru.com/blog/materi-bahasa-indonesia-sd' target='_blank'>Materi Bahasa Indonesia SD - Ruangguru</a></li>
                  <li><a href='https://www.scribd.com/document/456789013/Modul-Bahasa-Indonesia-SD-Kelas-4' target='_blank'>Modul Bahasa Indonesia Kelas 4 PDF (Scribd)</a></li>
                  <li><a href='https://www.slideshare.net/aguswahyudi/materi-bahasa-indonesia-sd-kelas-4' target='_blank'>Materi Bahasa Indonesia SD Kelas 4 - Slideshare</a></li>
                </ul>
              `;
            } else if(subject === 'sci') {
              moduleLinks = `
                <ul>
                  <li><a href='https://www.ruangguru.com/blog/materi-ipa-sd' target='_blank'>Materi IPA SD - Ruangguru</a></li>
                  <li><a href='https://www.scribd.com/document/456789014/Modul-IPA-SD-Kelas-4' target='_blank'>Modul IPA Kelas 4 PDF (Scribd)</a></li>
                  <li><a href='https://www.slideshare.net/aguswahyudi/materi-ipa-sd-kelas-4' target='_blank'>Materi IPA SD Kelas 4 - Slideshare</a></li>
                </ul>
              `;
            }
            if(materiDetail){
              materiDetail.innerHTML = `<h3>${subjectText}</h3>
                <p>Modul materi valid untuk ${subjectText}:</p>
                ${moduleLinks}
                <p><a href='https://www.google.com/search?q=materi+${encodeURIComponent(subjectText.toLowerCase())}+sd' target='_blank' style='color:#2196f3;text-decoration:underline'>Cari materi lain di Google</a></p>`;
            }
            if(materiPage){
              materiPage.style.display = 'block';
              materiPage.scrollIntoView({behavior:'smooth'});
            }
          };
        });

        if(uploadForm && uploadedFiles){
          uploadForm.onsubmit = function(e){
            e.preventDefault();
            var fileInput = document.getElementById('modulFile');
            var status = document.getElementById('uploadStatus');
            if(fileInput.files.length > 0){
              var file = fileInput.files[0];
              uploadedList.push(file.name);
              status.textContent = 'File berhasil diupload: ' + file.name;
              uploadedFiles.innerHTML = '<b>File Materi Anda:</b><ul>' + uploadedList.map(f => `<li>${f}</li>`).join('') + '</ul>';
              fileInput.value = '';
            } else {
              status.textContent = 'Pilih file terlebih dahulu.';
            }
          };
        }
      } catch(e) { /* ignore */ }
    })();
  </script>
  <script>
    (function(){
      try {
        var latihanMenu = document.getElementById('latihanMenu');
        var materiMenu = document.querySelector('nav a[href="#materi"]');
        var kuisMenu = document.querySelector('nav a[href="#kuis"]');
  var worksheetCard = document.getElementById('worksheet-card');
        var homeSection = document.getElementById('home');
        var materiSection = document.querySelector('.lessons');
        var kuisSection = document.getElementById('kuis');
  var latihanPageSection = document.getElementById('latihanPage');

        function hideAllSections() {
          if (homeSection) homeSection.style.display = 'none';
          if (worksheetCard) worksheetCard.style.display = 'none';
          if (materiSection) materiSection.style.display = 'none';
          if (kuisSection) kuisSection.style.display = 'none';
          if (latihanPageSection) latihanPageSection.style.display = 'none';
        }

        // Always attach handler to Latihan menu so clicking it opens latihan page
        if (latihanMenu) {
          latihanMenu.addEventListener('click', function(e) {
            e.preventDefault();
            hideAllSections();
            // Show the latihan page
            if (latihanPageSection) {
              latihanPageSection.style.display = 'block';
              latihanPageSection.scrollIntoView({behavior:'smooth'});
            }
            // Populate list from Firestore (function implemented in script.js)
            if (window.populateLatihanList) window.populateLatihanList();
          });
        }
        if (materiMenu && materiSection) {
          materiMenu.addEventListener('click', function(e) {
            e.preventDefault();
            hideAllSections();
            materiSection.style.display = 'block';
            materiSection.scrollIntoView({behavior:'smooth'});
          });
        }
        if (kuisMenu && kuisSection) {
          kuisMenu.addEventListener('click', function(e) {
            e.preventDefault();
            hideAllSections();
            kuisSection.style.display = 'block';
            kuisSection.scrollIntoView({behavior:'smooth'});
          });
        }
      } catch(e) { /* ignore */ }
    })();
  </script>
</body>
</html>
